# OSI 7 계층
### OSI 7 계층
* 실제로 OSI 7 계층을 모두 사용하지는 않는다.
* TCP/IP는 4 계층
* 그런데 각 계층이 무슨 기능을 하는지는 알아야 한다.
  * 장비는 2, 3, 4, 7의 기능을 한다.
  * 이 부분은 무조건 외울 것

### L1 : 물리 계층 (Physical Layer)
* 정말로 랜선 그 자체 - 물리적 연결
* 전기적 신호 - 실질적인 전송을 담당
* 리피터(신호 증폭기), 더미 허브(스위치) 등이 해당

IP 계층에서 맥헤더를 넣은 후 전기신호로 바뀌기 직전부터 전송 완료 후 다시 신호를 패킷으로 바꾸기 직전을 담당

LAN 케이블은 최대 100m
* 보통 70~80m 이상으로 안 만든다.

100 메가 인터넷 100mb/s
* 100 메가 비트 - 1억 비트

### L2 : 데이터 링크 계층 (Data Link Layer)
* 전송 단위 - 프레임(frame)
* 주소 - 맥(MAC Media Access Control)주소 사용
* 물리적 링크 - 신뢰성
  * 여기서 말하는 신뢰성 - 손상된 데이터는 전송하지 않음.
  * L1 계층에서 발생한 전송 오류를 처리
  * CRC 기반의 오류 검출 방법을 사용하여 오류 감지
* 홉 대 홉 전송 Point to Point
* 브리지, 스위치 등 장비가 대표적

맥주소는 원칙적으로 모두 유일한 주소여야 한다.
* 그러나 리퍼 제품 등 바이오스를 같은 걸로 밀어버리는 경우 같은 맥주소가 부여될 수 있음
* 같은 네트워크가 아니라면 문제되지는 않는다.
  * MAC 주소는 서브넷 안에서 사용되는 주소이기 때문

LAN 안에서의 통신은 MAC 주소를 활용

게임 벤 -> MAC 어드레스 기준
* 랜 카드를 바꾸면 윈도우 인증이 풀릴 수 있음

### L3 : 네트워크 계층 (Network Layer)
* 전송 단위 - 패킷(Packet)
* 송신측 ~ 수신측으로 전송하는 계층
* IP(Internet Protocol) 전송 방식 사용
* L3 스위치 - 라우터
  * 라우팅을 통해 패킷의 전송경로를 결정하여 L2 장비를 거쳐가며 패킷이 전송됨

### L4 : 전송 계층 (Transport Layer) 혹은 TCP 계층
* 전송 단위 - 세그먼트(Segment)
* L4에서 주소 - Port (프로세스 주소)
* 두 시스템간 데이터 전송을 보장
  * 오류 복구, 흐름제어 담당

L4에서의 신뢰성 있는 전송
* 오류 제어 : 시퀀스 넘버를 통해 누락된 세그먼트가 없고, 도착 세그먼트의 순서를 보장
* 흐름 제어 : 서로의 윈도우 사이즈(수신 버퍼 남은 크기)를 알림으로 윈도우 사이즈를 고려하여 데이터를 전송하는 것
* L1에서의 잡음은 L2에서 이미 걸러냈으므로 검사 안함
  * 그러나 L2에서 폐기된 패킷은 누락된 세그먼트이므로 재전송 요청함

### L5, L6, L7은 사실상 하나로 엮어서 설명
* 우리가 만드는 네트워크 라이브러리는 여기에 해당

L5 : 세션 계층 (Session Layer)
* 세션 관리

L6 : 프레젠테이션 계층 (Presentation Layer)
* 암복호화, 인코딩
* 우린 약간의 암호화

L7 : 응용 계층 (Application Layer)
* 응용 프로그램

네트워크 라이브러리
* Application 계층의 라이브러리를 만드는 것

L2, L3, L4, L7 장비가 무엇?
* 해당 계층의 헤더를 해석/수정할 수 있는 능력을 가진 장비

### 클라이언트가 서버로 무언가를 보내는 과정
Client의 포트 주소
* 보통 자동으로 설정
* 직접 설정 또한 가능
  * 그러나 TIME_WAIT을 고려하면 별로 좋지 않다.

만약 "aaa"라는 메시지를 보내는 과정
* send(서버IP, 서버 포트, "aaa");

TCP 계층
* 20byte 이상의 TCP 헤더가 붙음
  * 포트 번호가 기입됨
* TCP : "aaa" (payload)
* 연결할 때 옵션(가변 길이) 필드를 사용
  * 우리가 통신할 때는 무시

IP 계층
* 20byte 크기의 IP 헤더가 붙음
* TCP 연결 송수신을 할 때를 제외하고는 TCP + IP 헤더의 크기는 40바이트

이더넷 계층
* L2 장비의 맥주소를 헤더에 넣어야 함
* 맥주소는 우리가 알지 못한다.
  * L3 계층에서 라우팅을 통해 맥주소를 알아온다.
  * ARP 프로토콜

### IP 주소
호스트 부분에 0과 모든 비트를 1로 채울 수 없다.
* 모두 1로 채운건 - 브로드캐스트 전용 주소
  * UDP 브로드캐스트 전송에서 사용

예시
* IP : 192.168.0.8
* Subnetmask : 255.255.255.0
* 두개를 and & 연산하면 호스트 부분을 얻을 수 있다.
  * 네트워크 주소 192.168.0.0
  * 총 254개 사용 가능
* Gateway : 192.168.0.1
  * 네트워크가 나가는 문

### LAN의 정의
* 같은 네트워크 id를 가진 장비들의 집합
* LAN이 다르면 Gateway가 다음 경로를 찾는다.
  * MAC 주소를 찾는 대상

Gateway는 L3 장치
* ICMP, ARP, IP를 보조


### arp /a
* 등록된 arp 목록을 확인 가능
* arp 캐시에 저장된 것을 확인하는 것
  * arp 캐시는 보통 몇십초 동안 저장 - 갱신 주기 몇 십초

요즘 윈도우의 ARP
* 접속이 되면 같은 네트워크에 접속된 모든 장치에 ARP 패킷을 뿌린다.
* 기기들의 IP 주소가 바뀌는 경우가 흔하기 때문