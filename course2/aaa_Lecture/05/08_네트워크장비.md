# 05 08
### L3
* 네트워크는 LAN과 LAN이 묶인 그래프 구조
* L3 IP 계층은 LAN과 LAN이 통신하기 위한 계층
* 라우팅은 L3 스위치(라우터) 혹은 게이트웨이 -> 라우터이다.
* WAN에서는 라우터 -> 라우터

### route print 명령어
* 컴퓨터의 라우팅 테이블을 출력하는 명령어

### IP 종류

루프백 IP
* 자기 자신을 연결 대상으로 설정하기 위한 IP 주소
* 같은 장치에서의 프로세스끼리 통신할 때 사용
* 127.0.0.0 : 루프백 ip의 네트워크 id
* 127.0.0.1 : 루프백 ip 주소
* 127.255.255.255 : 루프백 ip의 네트워크 id에 해당하는 브로드캐스트

LAN 내에서 사용하는 IP
* 255.255.255.255 : 브로드 캐스트 전용 IP
* 224.0.0.0 : 멀티캐스트용 IP
* 192.168.0.0 : 네트워크 ID
* 192.168.0.1 : 기본 게이트웨이 IP 주소
* 192.168.0.255 : 브로드 캐스팅 IP

### 라우팅 테이블 해석법
(통신하고 싶은 호스트의 아이디 & 각 행의 넷마스크) == 네트워크 대상 IP
* 해당 네트워크 대상과 통신
* 게이트웨이 열의 연결됨 - 같은 LAN 상에 존재한다는 의미

어떠한 네트워크 대상과도 목적지 IP가 일치하지 않으면
* 0.0.0.0 행에 해당하는 게이트웨이로 패킷을 보낸다.
* 같은 LAN에 존재하지 않는다는 의미

라우터는 라우팅 테이블을 이용하여 자신 이후의 라우터를 결정
* 이후 ARP를 통해 다음 라우터의 MAC Address를 찾아 송신

MAC 헤더는 L3에서 만든다는 오해가 있지만 L2에서 만든다.
* L3에서 ARP 프로토콜을 통해 MAC 주소를 알아내기는 한다.
* 상위 계층에서 제공하는 정보를 그대로 대입한다.
* 헤더의 생성은 L2 계층에서 수행한다.

### 게이트웨이란
* 그냥 라우터 : LAN과 WAN 사이에 인터페이스로 존재

### TTL (Time to Live)
만약 잘못된 IP(존재하지 않는 IP)가 입력되면 어떻게 될까?
* 영원히 네트워크를 떠돌게 된다.
* 이러한 상황을 막기 위해 IP 헤더에 TTL이라는 값을 넣고, 라우터에 도착할 때마다 -1을 한다.
* TTL이 0이 되면 라우터는 송신지에게 ICMP 에러 메시지를 보낸다.

### ICMP(Internet Control Message Protocol)
오류 알림 메시지
* 라우터가 송신지에게 알리는 메시지
* 3계층 패킷

### L2 장비
더미 허브, 스위칭 허브
* 더미 허브 안쓴다.

### 스위칭 허브
필터링(filtering)
* 프레임을 걸러내는 기능
* 다음 장비로 전달할지 폐기할지 결정

포워딩(forwording)
* 전송될 장치를 결정하고 프레임을 해당 포트로 보내는 기능

모두 스위치 테이블을 통해 이루어짐
* 크기는 요즘 보통 1K ~ 4K
* 스위치는 대상에게만 전송
* 계속 메모리에 적재

스위치 테이블
* MAC 주소, 포트 번호, 등록시간을 기록
* MAC 주소를 조회하여 포트 번호로 전송
* 행에 등록된 MAC 주소로 프레임이 도착하지 않으면 행을 지움

만약 스위치 테이블에 MAC 주소가 없다면?
* 모든 포트로 브로드캐스트

PPS(Packet Per Second)
* 패킷 당 처리 시간

### Tracert 명령어
라우터의 경로는 확인하는 명령어이다.
* ICMP 프로토콜을 활용하여 추적하는 방식
* TTL을 1로 보내면 ICMP로 응답
* TTL을 1씩 늘려가며 다음 라우터를 알아내는 방식
* 만약 요청시간이 만료되었다면 - 해당 라우터는 ICMP 요청을 무시하도록 설정된 것

언제 쓰는가?
* 규모 있는 거대한 네트워크 구축
* 내부 망에서 어디까지 도달하는지 체크

### L4 스위치
기본적인 기능
* NAT 테이블을 이용하여 공인 IP와 사설 IP를 변환하는 것
  * NAT 기능
  * 공유기 역할
* 방화벽 역할도 가능

부가적인 기능
* 로드 밸런싱 - 부하 분산

### 로드 밸런싱을 L4에서 하는 이유
한번에 응답이 끝날 수 없는 경우가 있기 때문
* 연결 : 4 way
* 끊기 : 3 way

같은 서버에 연결되도록 해야한다.

그러려면 포트도 어디에 연결되었는지 구분해야 한다.
* L4 헤더까지 확인해야 한다.