# DNS
### 도메인
* IP 주소를 기억하여 접속하기 어렵기 때문에 사용하는 별칭
* 도메인은 name resolution을 거쳐 IP 주소로 변환되어야 사용 가능
* 도메인은 트리 구조
  * abc.co.kr
  * kr -> co -> abc
  * .을 기준으로 관리
* 도메인은 대행사를 통하여 구매
  * 가비아, 카페24

게임 서버에서는 도메인 이름을 하드코딩
* 클라이언트에서 접속할 때 서버의 ip를 획득하기 위함.
* ip를 하드코딩하지 않는 이유는 서버 ip가 바뀌는 경우를 대비한 것임.

### DNS Domain Name System
* 도메인을 관리하는 시스템
* 도메인과 서브 도메인의 관리와 소유의 주체가 다를 수 있음
* 원칙적으로는 서브 도메인의 소유와 관리의 권한은 상위 도메인이 가짐
  * naver.com 은 .com의 서브 도메인 호스트는 naver
  * root 도메인의 바로 아래자식 도메인들 com, kr 등을 TLD(Top Level Domain)라고 부른다.
  * 최상위 . 루트 도메인 com. , kr.
  * 루트 도메인 정보는 모두가 가진다.
* .com에게 권한을 사오면 naver.com의 서브 도메인 blog.naver.com 등의 소유권 및 관리의 주체는 구매자
  * 원칙적으로는 구매자가 DNS 서버를 만들고 해당 도메인의 질의를 책임져야 함

### DNS의 영역
* 영역(Zone) : 관리와 소유의 단위가 부여된 도메인과 서브트리의 집합
* 영역의 DNS 관리자는 신규 항목에 대한 이름, IP 주소 등을 DNS 서버에 등록해야 함

### DNS 서버와 캐싱
DNS 서버
* 자신이 관리하는 도메인이 포함되는 영역에 대해 도메인이름 : IP 주소 정보를 가짐
* DNS 서버는 질의를 받으면 응답해야함

### DNS 서버 두 종류
영역(Zone)의 관리자가 관리하는 서버
* 얘도 캐싱을 함
* 영역의 관리자는 최소 2개 이상의 DNS 서버
* 1차 서버 - 가장 최신의 정보 (Authorize 서버ㄹ고 함)
* 2차 서버 - 1차 서버에게 정보를 얻어옴


다른 영역의 정보를 캐시하는 캐시 서버
* 다른 영역서버에서 정보를 얻어와 캐싱  

### nslookup
도메인 이름 조회 명령어

권한 없는 응답
* 캐시된 것을 보여준다는 의미
* 우리의 컴퓨터에도 DNS 캐시 기능이 있다.

컴퓨터의 DNS 캐시를 비우는 명령어
* ipconfig /flushdns

### DNS 서버의 TTL
DNS 서버에서 그 정보를 저장할 시간
* TTL이 만료되면 DNS 서버에서 정보를 지움

만약 서버에서 도메인 네임을 바꿀일이 있으면
* 미리 TTL을 감소시켜 설정하여 변경 이전의 IP 정보가 남는 시간을 줄인다.

### PC의 도메인 서버 설정에 여러개 등록하는 이유
도메인 서버 -> 처음 연결의 도입부

만약 이게 다운된다면?
* 모든 것이 마비된다.

따라서 여러개를 등록한다.
* 등록된 것들 중 1개 알아서 조회


### DNS 서버의 로드밸런서 역할
DNS 서버에 같은 도메인 이름으로 여러개의 IP를 등록하면
* 번갈아가면서 IP를 알려준다.

### DDNS
Dynamic DNS
* IP가 자주 바뀌는 서버가 이용
* 만약 집에서 구축한 서버 - DHCP 시간이 만료되면 IP가 바뀜
* 공유기 차원에서 무료로 지원하는 기능이다.


### NAT 네트워크 주소 변환
NAT
* LAN에서 WAN으로 나갈 때 사설 IP와 공유기의 공인 IP를 매핑하는 기능
* IP - 포트 번호 쌍을 공유기 내부의 포워딩 테이블에 기록 (동적 포트포워딩)
  * 사설IP, 포트 : 공인IP, 포트

서버 입장
* 공유기 공인 IP와 포트가 발신자의 것으로 보인다.
* 서버가 클라한테 패킷을 보내면 주소변환을 수행하고 PC까지 패킷이 도달
  * 외부에서 내부로 들어올 때 공유기는 포워딩 테이블을 뒤짐
  * 찾으면 패킷의 IP와 포트 번호를 사설IP의 것으로 수정

공유기는 최대 65535개의 호스트의 연결만 허용 가능

공유기의 성능을 좌우하는 가장 큰 요소
* NAT 기능
* 메모리 용량
  * 포워딩 테이블을 크게 유지 가능

### UPNP
포트포워딩을 알아서 해주는 것
* XML 형식의 프로토콜이다.
* 보안상 좋지 않다.
* 자동으로 켜져있는 옵션
* 집 내부 카메라 (아기, 강아지 보는 용도) 등이 이를 사용
  * 해킹되기 쉽다.

### 홀펀칭
* 동적 포트포워딩을 응용
* 외부의 사용자가 접속할 수 있도록 유도하는 것


랑데부 서버
* 클라이언트가 랑데부 서버로 udp 패킷을 쏜다.
* 그럼 동적 포트포워딩으로 공유기의 테이블에 등록됨
* 그럼 다른 유저들은 여기로 통신을 시도

그런데 이 방식은 100% 되진 않는다.
* 공유기에 따라 걸러내는 경우가 있음
* 대략 80%의 성공률을 보인다고 한다.

따라서 요즘 P2P 서버는 릴레이 서버를 채용
* 패킷을 중계하는 방식
* 릴레이 서버는 결국 C-S 구조가 된다.